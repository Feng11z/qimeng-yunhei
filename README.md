```markdown
# 云黑查询插件 for Koishi

基于云黑API实现的用户信息查询插件，支持速率限制与安全配置。

## 📦 安装

```bash
npm install koishi-plugin-yunhei-query
```

## ⚙️ 配置

在 `koishi.yml` 中添加配置：

```yaml
plugins:
  yunhei-query:
    apiKey: "your_api_key_here"  # 必填（需向云黑平台申请）
    endpoint: "http://yunhei.qimeng.fun:12301/OpenAPI.php"  # 可选
    timeout: 5000               # 请求超时时间（毫秒）
    enableCache: false          # 强制禁用缓存（配置项无效）
```

## 🕹 使用命令

### 基础查询
```bash
yunhei <用户ID>
示例：yunhei 123456
```

### 选项说明
- `-f, --force` 强制刷新缓存（当前版本已强制禁用缓存功能）

## 🛡 功能特性

### 速率限制
- 用户级频率控制（30次/分钟）
- 自动重置计数器（60秒周期）
- 超限提示与日志记录

### 错误处理
| 错误类型          | 处理方式                     |
|-------------------|----------------------------|
| API密钥未配置     | 阻断服务并提示              |
| API请求超时       | 记录日志并返回友好提示      |
| 非常规响应结构    | 数据校验失败提示            |

## 📊 数据响应

### 成功响应示例
```
云黑查询结果：
◾ 状态：列入
◾ 类型：       
◾ 原因： 
◾ 处理人：幻梦
◾ 危险等级：4
◾ 记录时间：2023-08-15 14:22:31
```

### 异常响应
- `未查询到有效云黑信息`：ID不存在或数据异常
- `服务暂不可用`：核心配置错误
- `服务器返回异常`：API非200状态码

## ⚠️ 注意事项

1. **密钥安全**
   - API Key需通过`role('secret')`加密存储
   - 推荐使用环境变量方式注入

2. 性能指标
   - 默认5秒超时（可配置1000-15000ms）
   - 内置请求耗时监控日志

3. 强制限制
   - 永久禁用缓存系统（无视enableCache配置）
   - 用户级速率限制不可配置

## 📜 开源协议

MIT License © [Lanyu-cn] 

```
